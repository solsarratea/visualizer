window.guiData = {
    "preset": "cells",
    "remembered": {
      "pez azul": {
        "0": {
          "color1": {
            "r": 255,
            "g": 255,
            "b": 255
          },
          "color2": {
            "r": 0,
            "g": 47.00000000000006,
            "b": 255
          },
          "color3": {
            "r": 20.963541666666668,
            "g": 20.963541666666668,
            "b": 57.49999999999999
          },
          "dA": 0.778,
          "dB": 0.421,
          "timeStep": 0.003,
          "feed": 0.0078000000000000005,
          "k": 0.051000000000000004,
          "flow": 1,
          "brushSize": 142.9454699407282,
          "zoom": 0.001473,
          "rotate": 0,
          "iterations": 1,
          "centroX": 925,
          "centroY": 490.5,
          "interpolate": 0.00413
        }
      },
      "azul 2": {
        "0": {
          "color1": {
            "r": 230,
            "g": 230,
            "b": 230
          },
          "color2": {
            "r": 35,
            "g": 91.47058823529406,
            "b": 155
          },
          "color3": {
            "r": 0.9895833333333299,
            "g": 1.9664486434108492,
            "b": 85.00000000000001
          },
          "dA": 0.507,
          "dB": 0.497,
          "timeStep": 0.0041,
          "feed": 0.006,
          "k": 0.0257,
          "flow": 1,
          "brushSize": 30,
          "zoom": 0.005809,
          "rotate": -0.007188,
          "iterations": 4,
          "centroX": 918.5774767146486,
          "centroY": 433.93259949195595
        }
      },
      "worms": {
        "0": {
          "color1": {
            "r": 24.999999999999996,
            "g": 8.379289215686274,
            "b": 8.379289215686274
          },
          "color2": {
            "r": 210,
            "g": 138.32720588235293,
            "b": 138.32720588235293
          },
          "color3": {
            "r": 240,
            "g": 240,
            "b": 240
          },
          "dA": 0.648,
          "dB": 0.15,
          "timeStep": 0.002,
          "feed": 0.034,
          "k": 0.063,
          "flow": 1,
          "brushSize": 30,
          "zoom": 0,
          "rotate": 0,
          "iterations": 4,
          "centroX": 1326,
          "centroY": 274.44741744284505
        }
      },
      "bonito": {
        "0": {
          "color1": {
            "r": 143.78063725490196,
            "g": 143.78063725490196,
            "b": 190
          },
          "color2": {
            "r": 155.00000000000003,
            "g": 35.2359068627451,
            "b": 94.13628053680492
          },
          "color3": {
            "r": 235.00000000000003,
            "g": 114.051047892419,
            "b": 51.118259803921575
          },
          "dA": 0.778,
          "dB": 0.20400000000000001,
          "timeStep": 0.0204,
          "feed": 0.006,
          "k": 0.0257,
          "flow": 1,
          "brushSize": 30,
          "iterations": 1,
          "centroX": 820.0169348010162,
          "centroY": 518.9913632514819
        }
      },
      "cells": {
        "0": {
          "color1": {
            "r": 1.5487132352941122,
            "g": 1.5487132352941122,
            "b": 2.499999999999991
          },
          "color2": {
            "r": 220,
            "g": 32.75735294117648,
            "b": 32.75735294117648
          },
          "color3": {
            "r": 67.87224264705884,
            "g": 202.50000000000003,
            "b": 67.87224264705884
          },
          "dA": 0.421,
          "dB": 0.171,
          "timeStep": 0.01,
          "feed": 0.106,
          "k": 0.055,
          "flow": 1,
          "brushSize": 30,
          "iterations": 1
        }
      },
      "fire": {
        "0": {
          "color1": {
            "r": 130,
            "g": 0,
            "b": 0
          },
          "color2": {
            "r": 220,
            "g": 32.75735294117648,
            "b": 32.75735294117648
          },
          "color3": {
            "r": 66.10294117647057,
            "g": 101.71349789915965,
            "b": 120
          },
          "dA": 0.352,
          "dB": 0.161,
          "timeStep": 0.01,
          "feed": 0.006,
          "k": 0.037000000000000005,
          "flow": 1,
          "brushSize": 40.955361251725726,
          "iterations": 1
        }
      },
     
      "viol": {
        "0": {
          "color1": {
            "r": 232.5,
            "g": 232.5,
            "b": 232.5
          },
          "color2": {
            "r": 150,
            "g": 119.39338235294117,
            "b": 119.39338235294117
          },
          "color3": {
            "r": 81.10782480727337,
            "g": 61.233149509803916,
            "b": 177.5
          },
          "dA": 0.128,
          "dB": 0.096,
          "timeStep": 0.0529,
          "feed": 0.006,
          "k": 0.0257,
          "flow": 1,
          "brushSize": 100,
          "iterations": 1
        }
      },
      "liv": {
        "0": {
          "color1": {
            "r": 1.5487132352941122,
            "g": 1.5487132352941122,
            "b": 2.499999999999991
          },
          "color2": {
            "r": 52.500000000000014,
            "g": 30.978860294117656,
            "b": 30.978860294117656
          },
          "color3": {
            "r": 38.64583333333333,
            "g": 135.37952196382432,
            "b": 170.00000000000003
          },
          "dA": 0.215,
          "dB": 0.182,
          "timeStep": 0.005200000000000001,
          "feed": 0.006,
          "k": 0.0257,
          "flow": 1,
          "brushSize": 30,
          "iterations": 1,
          "zoom": 0
        }
      },
      "hip": {
        "0": {
          "color1": {
            "r": 1.5487132352941122,
            "g": 1.5487132352941122,
            "b": 2.499999999999991
          },
          "color2": {
            "r": 220,
            "g": 32.75735294117648,
            "b": 32.75735294117648
          },
          "color3": {
            "r": 63.00000000000001,
            "g": 169.29411764705875,
            "b": 202
          },
          "dA": 0.388,
          "dB": 0.161,
          "timeStep": 0.01,
          "feed": 0.006,
          "k": 0.037000000000000005,
          "flow": 1,
          "brushSize": 30,
          "iterations": 1,
          "zoom": 0
        }
      },
      "naranja": {
        "0": {
          "color1": {
            "r": 255,
            "g": 144.70281862745097,
            "b": 102.96875
          },
          "color2": {
            "r": 92.50000000000001,
            "g": 3.7974877450980364,
            "b": 3.7974877450980364
          },
          "color3": {
            "r": 179.99999999999997,
            "g": 100.55865921787708,
            "b": 0
          },
          "dA": 0.854,
          "dB": 0.139,
          "timeStep": 0.0529,
          "feed": 0.006,
          "k": 0.0257,
          "flow": 1,
          "brushSize": 100,
          "zoom": 0,
          "rotate": 0,
          "iterations": 1,
          "centroX": 998.7806943268417,
          "centroY": 497.7266723116003
        }
      },
      "palms": {
        "0": {
          "color1": {
            "r": 19.72886029411765,
            "g": 132.49999999999997,
            "b": 76.60473945012784
          },
          "color2": {
            "r": 102.5,
            "g": 0,
            "b": 0
          },
          "color3": {
            "r": 80.46875,
            "g": 255,
            "b": 255
          },
          "dA": 0.757,
          "dB": 0.15,
          "timeStep": 0.0106,
          "feed": 0.09000000000000001,
          "k": 0.059000000000000004,
          "flow": 1,
          "brushSize": 30,
          "zoom": 0,
          "rotate": 0.001473,
          "iterations": 1,
          "centroX": 858.4250635055039,
          "centroY": 455.1972904318375
        }
      }
    },
    "closed": false,
    "folders": {}
  }
//choose your fish 
//https://www.google.com/imgres?imgurl=https%3A%2F%2F4.bp.blogspot.com%2F-Yag1AJMNzoo%2FVj-z3zSlpKI%2FAAAAAAAAYR4%2FD-6g3hcuWfo%2Fs1600%2Fhoneycomb-cowfish-ad.jpg&imgrefurl=https%3A%2F%2Flittlesomethings.blogspot.com%2F2015%2F11%2Freaction-diffusion.html&tbnid=X7G-kFsQfejG2M&vet=12ahUKEwj7vdiD5fXoAhXKHN8KHV0rAu0QMygPegUIARCFAg..i&docid=Eg8VPNUMA_LQzM&w=504&h=353&q=reaction%20diffusion%20nature&ved=2ahUKEwj7vdiD5fXoAhXKHN8KHV0rAu0QMygPegUIARCFAg#h=353&imgdii=GMrsS2e_t6sllM:&vet=12ahUKEwj7vdiD5fXoAhXKHN8KHV0rAu0QMygPegUIARCFAg..i&w=504
  
  function Brush(){
      this.x = window.innerWidth;
      this.y = window.innerHeight;
      this.enable = 0;
      
      this.isDown = false;
  
      var vx = 0;
      var vy = 0;
      var mx = 0;
      var my = 0;
      var mouseIsDown = false;
      
      this.swap = function(){
          this.enable = !this.enable;
          console.log(this.enable)
      }
  
      this.update = function(){
          if (!mouseIsDown) {
              vx += (Math.random() * 2 - 1) * 1.0;
              vy += (Math.random() * 2 - 1) * 1.0;
  
              vx *= 0.99;
              vy *= 0.99;
  
              mx += vx;
              my += vy;
  
              if (mx > window.innerWidth) mx = 0;
              if (mx < 0) mx = window.innerWidth;
  
              if (my > window.innerHeight) my = 0;
              if (my < 0) my = window.innerHeight;
          }
  
          this.isDown = 1;
          if (mouseIsDown) this.isDown = 1;
          else this.isDown = 0;
  
          this.x = mx;
          this.y = my;
      }
  
      window.addEventListener('mousedown', function() {
          mouseIsDown = true;
          vx = 0;
          vy = 0;
          mx = event.clientX;
          my = window.innerHeight - event.clientY;
      });
  
      window.addEventListener('mouseup', function() {
          mouseIsDown = false;
      });
  
      window.addEventListener('mousemove', function() {
          if (mouseIsDown)
          {
              mx = event.clientX;
              my = window.innerHeight - event.clientY;
          }
          
      })
  }
  
  if ( navigator.mediaDevices && navigator.mediaDevices.getUserMedia ) {
  
    var constraints = { video: { width: 1280, height: 720, facingMode: 'user' } };
  
    navigator.mediaDevices.getUserMedia( constraints ).then( function ( stream ) {
  
      // apply the stream to the video element used in the texture
  
      video.srcObject = stream;
      video.play();
  
    } ).catch( function ( error ) {
  
      console.error( 'Unable to access the camera/webcam.', error );
  
    } );
  
  } else {
    console.error( 'MediaDevices interface not available.' );
  
  }
  
  var scene, camera, renderer, width,height,controls,dragControls;
  var video, videoTexture, movieScreen; 

  
  function setupMainScene()
  {
    scene = new THREE.Scene();
    var width = window.innerWidth;
    var height = window.innerHeight;
    camera = new THREE.OrthographicCamera( width / - 2, width / 2, height / 2, height / - 2, 1, 1000 );
    camera.position.z = 2;
    renderer = new THREE.WebGLRenderer();
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );
  
        ///////////
      // VIDEO //
      //////////
  
    video = document.getElementById( 'video' );
    videoTexture = new THREE.VideoTexture( video );
    videoTexture.minFilter = THREE.LinearFilter;
    videoTexture.magFilter = THREE.LinearFilter;
    
    movieMaterial = new THREE.MeshBasicMaterial( { map: videoTexture, overdraw: true, side:THREE.DoubleSide } );
    // the geometry on which the movie will be displayed;
    // 		movie image will be scaled to fit these dimensions.
    movieGeometry = new THREE.PlaneGeometry( 240, 100, 4, 4 );
    movieScreen = new THREE.Mesh( movieGeometry, movieMaterial );
    movieScreen.position.set(0,50,0);
    //scene.add(movieScreen);
    
    camera.position.set(0,150,300);
    camera.lookAt(movieScreen.position);
  }
  
  
  window.dA = .2;
  window.dB = 0.2;
  window.feed = 0.031;
  window.k = 0.057;
  window.brushSize = 1;
  window.clear = 0;
  window.iterations = 1;
  window.flow = 1.00;
  window.timeStep = 0.01;
  window.brush = new Brush();
  window.zoom = 0.;
  window.rotate = 0.;
  window.centroX = window.innerWidth/2.;
  window.centroY = window.innerHeight/2.;
  window.interpolate = 0;
  
  
  var bufferScene, textureA,textureB, initText;
  function setupBufferScene() {
  
      bufferScene = new THREE.Scene();
    
      textureA = new THREE.WebGLRenderTarget( window.innerWidth, window.innerHeight, { 
      minFilter: THREE.LinearFilter, 
      magFilter: THREE.LinearMipMapLinearFilter, 
      format: THREE.RGBAFormat,
      type: THREE.FloatType});
  
      textureB = new THREE.WebGLRenderTarget( window.innerWidth, window.innerHeight, { 
      minFilter: THREE.LinearFilter, 
      magFilter: THREE.LinearMipMapLinearFilter, 
      format: THREE.RGBAFormat,
      type: THREE.FloatType} );
  
      initText = videoTexture;
  }
  
  var plane, bufferObject;
  function initBufferScene(){ 
      bufferMaterial = new THREE.ShaderMaterial( {
      uniforms: {
          bufferTexture: { type: "t", value: textureA.texture },
          start: { type: "t", value: initText },
          res : {type: 'v2',value:new THREE.Vector2(window.innerWidth ,window.innerHeight)},
          brush: {type:'v3',value:new THREE.Vector3(0,0,0)},
          time: {type:'f', value:0.0},
          dA: {type:'f', value:dA},
          dB: {type:'f', value:dB},
          feed: {type:'f', value:feed},
          k: {type:'f', value:k},
          brushSize: {type:'f', value:brushSize},
          clear: {type:'i', value:clear},
          enableBrush: {type:'i', value: 0},
          flow: {type:'f', value:flow},
          diff1:  {type:'f', value: 0.2*flow},
          diff2:  {type:'f', value: 0.05*flow},
          zoom:  {type:'f', value: zoom},
          rotate:  {type:'f', value: rotate},
          centroX:  {type:'f', value: centroX},
          centroY:  {type:'f', value: centroY},
          t:  {type:'f', value: interpolate},
          
  
      },
          fragmentShader: document.getElementById( 'fragShader' ).innerHTML
      } );
  
      plane = new THREE.PlaneBufferGeometry( window.innerWidth, window.innerHeight);
      bufferObject = new THREE.Mesh( plane, bufferMaterial );
      bufferScene.add(bufferObject);
  }
  
  
window.color1 = new THREE.Color(255, 255, 0);
window.color2 = new THREE.Color(255, 0, 0);
window.color3 = new THREE.Color(0, 204, 255);
  
  var finalMaterial, geom, quad;
  function initFinalScene(){
    finalMaterial = new THREE.ShaderMaterial( {
      uniforms : {
        video: { type : 't', value : initText, minFilter : THREE.NearestFilter },
        resolution : { type : 'v2', value : new THREE.Vector2( window.innerWidth, window.innerHeight) },
        texture : { type : 't', value : textureB.texture, minFilter : THREE.NearestFilter },
        color1 : { type : 'c', value : color1 },
        color2 : { type : 'c', value : color2 },
        color3 : { type : 'c', value : color3 }
    },
      fragmentShader : document.getElementById( 'colorize' ).textContent
    } );
  
    geom = new THREE.PlaneBufferGeometry( window.innerWidth, window.innerHeight);
    quad = new THREE.Mesh( geom, finalMaterial );
    scene.add(quad);   
  }
  
  setupMainScene();
  setupBufferScene();
  initBufferScene();
  initFinalScene();

 window.loadScreen = () => { clear = 1; }
window.Brushable = () => { brush.swap(); }
  
  function addGuiControls(){
  
    var gui = new dat.GUI({load: guiData });
        gui.remember(this);
        
        gui.addColor(this, "color1");
        gui.addColor(this, "color2");
        gui.addColor(this, "color3");
        gui.add(this, "dA", 0.0, 1.0).step(0.001);
        gui.add(this, "dB", 0.0, 1.0).step(0.001);
        gui.add(this, "timeStep", 0.0, 0.1).step(0.0001);
        gui.add(this, "feed", 0.0, 0.15).step(0.0001);
        gui.add(this, "k", 0.0, 0.15).step(0.0001);
        gui.add(this, "flow", 1.0, 1.01);
        gui.add(this, "brushSize", 1, 200);
        gui.add(this, "zoom", -0.1, 0.1).step(0.000001);
        gui.add(this, "rotate", -0.1, 0.1).step(0.000001);
        gui.add(this, "iterations", 0, 100).step(1);
        gui.add(this, "loadScreen");
        gui.add(this, "Brushable");
        gui.add(this, "centroX",0,window.innerWidth);
        gui.add(this, "centroY",0,window.innerHeight);
        gui.add(this, "interpolate",0.,0.2).step(0.0001);
        gui.close();
  }
  addGuiControls();
  
  function nStepSimulation(){
      for (var i=0; i<iterations; i++){
          //Draw to textureB
          renderer.setRenderTarget(textureB);
          renderer.render(bufferScene, camera);
      
          renderer.setRenderTarget(null);
          renderer.clear();
              
     
         //Swap textureA and B
         var temp = textureA;
         textureA = textureB;
         textureB = temp;
     
         quad.material.map = textureB.texture;
         bufferMaterial.uniforms.bufferTexture.value = textureA.texture;
      }
  }
  
  var currentTime = bufferMaterial.uniforms.time.value;
  function render() {
      requestAnimationFrame( render );
  
      brush.update();
      bufferMaterial.uniforms.brush.value.x = brush.x;
      bufferMaterial.uniforms.brush.value.y = brush.y;
      bufferMaterial.uniforms.brush.value.z = brush.isDown;
  
      nStepSimulation(); 
  
      bufferMaterial.uniforms.time.value += timeStep;
      bufferMaterial.uniforms.zoom.value = zoom;
      bufferMaterial.uniforms.dA.value = dA;
      bufferMaterial.uniforms.dB.value = dB;
      bufferMaterial.uniforms.feed.value = feed;
      bufferMaterial.uniforms.k.value = k;
      bufferMaterial.uniforms.brushSize.value = brushSize;
      bufferMaterial.uniforms.clear.value = clear;
      bufferMaterial.uniforms.enableBrush.value = brush.enable;
      bufferMaterial.uniforms.flow.value = flow;
      bufferMaterial.uniforms.rotate.value = rotate;
      bufferMaterial.uniforms.centroX.value = centroX;
      bufferMaterial.uniforms.centroY.value = centroY;
      bufferMaterial.uniforms.t.value = interpolate;
  
      finalMaterial.uniforms.color1.value.r = color1.r/255;
      finalMaterial.uniforms.color1.value.g = color1.g/255;
      finalMaterial.uniforms.color1.value.b = color1.b/255;
  
      finalMaterial.uniforms.color2.value.r = color2.r/255;
      finalMaterial.uniforms.color2.value.g = color2.g/255;
      finalMaterial.uniforms.color2.value.b = color2.b/255;
  
      finalMaterial.uniforms.color3.value.r = color3.r/255;
      finalMaterial.uniforms.color3.value.g = color3.g/255;
      finalMaterial.uniforms.color3.value.b = color3.b/255;
  
  
    renderer.render( scene, camera );
  }
  
  render();